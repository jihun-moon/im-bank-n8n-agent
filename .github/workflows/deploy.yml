name: Deploy to Ncloud server

on:
  push:
    branches: [ main ]   # main ë¸Œëœì¹˜ì— push ë  ë•Œë§ˆë‹¤ ì‹¤í–‰

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: SSH & deploy
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: 223.xxx.xxx.xxx          # â˜… ì—¬ê¸° ì„œë²„ IPë¡œ ë³€ê²½
          username: root                 # ì§€ê¸ˆ ì ‘ì†í•˜ëŠ” ê³„ì •
          key: ${{ secrets.CI_SSH_KEY }} # ì•„ê¹Œ ë§Œë“  GitHub Secret ì´ë¦„
          script: |
            echo "âœ… Connected to server"
            cd /root/im-bank-n8n-agent

            # git ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
            git pull origin main

            # ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ (ì²˜ìŒ/ë³€ê²½ ì‹œ)
            cd backend
            npm install
            # pm2ë¡œ ë°±ì—”ë“œ ì¬ì‹œì‘ (ë‚˜ì¤‘ì— pm2 ì„¤ì¹˜ í›„ ì‚¬ìš©)
            # pm2 restart im-bank-backend || pm2 start server.js --name im-bank-backend

            # í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ (ì„ íƒ)
            cd ../frontend
            npm install
            npm run build

            echo "ğŸš€ Deploy finished"
