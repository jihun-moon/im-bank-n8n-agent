{
  "name": "PII (Personally Identifiable Information) detection bot",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=[ì—­í• ]\në‹¹ì‹ ì€ IMë¹µí¬ì˜ **ë³´ì•ˆ ë¶„ì„ ì–´ì‹œìŠ¤í„´íŠ¸** ì…ë‹ˆë‹¤.\nì‚¬ìš©ìê°€ ë³´ì•ˆ ê´€ë ¨ ì§ˆë¬¸(ë¡œê·¸/ì¸ì‹œë˜íŠ¸/ì„¤ì •/PII ë“±)ì„ ì…ë ¥í•˜ë©´ ì•„ë˜ ê·œì¹™ì„ ë”°ë¼ ì‘ë‹µí•˜ì„¸ìš”.\n\n[ì§ˆë¬¸ ë¶„ë¥˜]\n- ì¸ì‹œë˜íŠ¸ ë¶„ì„í˜•: ì§ˆë¬¸ì— 'ë¡œê·¸', 'ìœ ì¶œ', 'ë°±ì—…', 'ê³„ì •', 'ë¡œê·¸ì¸ ì‹¤íŒ¨', 'PII', 'ì™¸ë¶€ ì „ì†¡' ë“± ì¸ì‹œë˜íŠ¸ ê´€ë ¨ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ ì¸ì‹œë˜íŠ¸ ë¶„ì„í˜•ìœ¼ë¡œ ì²˜ë¦¬.\n- ì§€ì‹ ì„¤ëª…í˜•: ì •ì±…/ì ˆì°¨/ì„¤ì • ë¬¸ì˜ì´ë©´ ì§€ì‹ ì„¤ëª…í˜•.\n- ì¼ë°˜ ì§ˆë¬¸: ëª¨í˜¸í•˜ë©´ ì¼ë°˜ ë‹µë³€(ê¶Œì¥: ì¶”ê°€ ì •ë³´ ìš”ì²­).\n\n[ì¶œë ¥ í˜•ì‹ â€” ë°˜ë“œì‹œ ì´ í˜•ì‹ì„ ë”°ë¦„]\nğŸ“„ **ë³´ì•ˆ ë¶„ì„ ê²°ê³¼**\n- ì§ˆë¬¸ ìœ í˜•: (ì¸ì‹œë˜íŠ¸ ë¶„ì„ / ë³´ì•ˆ ì§€ì‹ ì„¤ëª… / ì¼ë°˜ ì§ˆë¬¸)\n- ìœ„í—˜ë„: High / Medium / Low / Safe / íŒë‹¨ ë¶ˆê°€\n- ì´ë²¤íŠ¸ ìœ í˜•: (ì˜ˆ: ë‚´ë¶€ì ì •ë³´ìœ ì¶œ / ê³„ì • íƒˆì·¨ / ì•…ì„± ë©”ì¼ / ì„¤ì • ì˜¤ë¥˜ / ì ‘ê·¼ ì‹œë„ / ê¸°íƒ€)\n- íƒì§€ëœ ê°œì¸ì •ë³´(PII): (ìˆìœ¼ë©´ ìœ í˜• ë‚˜ì—´, ì—†ìœ¼ë©´ â€˜íƒì§€ë˜ì§€ ì•ŠìŒâ€™)\n- AI íŒë‹¨ ì´ìœ : (êµ¬ì²´ì  ê·¼ê±° 2~4ë¬¸ì¥)\n- ê¶Œì¥ ì¡°ì¹˜: (ì‹¤ë¬´ ë‹¨ê³„í˜• ê¶Œì¥ 2~5ê°œ)\n- ìœ ì‚¬ ì‚¬ë¡€: (ê°€ëŠ¥í•˜ë©´ 1~2ê°œ ìš”ì•½, ì—†ìœ¼ë©´ â€˜ìœ ì‚¬ ì‚¬ë¡€ ì—†ìŒâ€™)\n\n[ë°ì´í„° ìš°ì„ ìˆœìœ„ â€” ê²€ìƒ‰ ìˆœì„œ]\n1. ë³´ì•ˆ ì§€ì‹ ë² ì´ìŠ¤ (vector_store_key)\n2. Notion DB (AI ì¸ì‹œë˜íŠ¸ ë¡œê·¸)\n3. ì¼ë°˜ ë³´ì•ˆ ì •ì±…(ë‚´ì¥ ì§€ì‹)\n\n[ë°ì´í„° ë¶€ì¡± ì‹œ]\n- â€œë¡œê·¸ ì„¸ë¶€ì •ë³´ê°€ ë¶€ì¡±í•´ íŒë‹¨ ë¶ˆê°€â€ë¥¼ ëª…ì‹œí•˜ê³ , ìµœì†Œí•œìœ¼ë¡œ ê¶Œì¥ ì¡°ì¹˜(íƒì§€/ê²©ë¦¬/ë¡œê·¸ ìˆ˜ì§‘)ë¥¼ ì œì‹œ.\n\n[ì¶”ê°€ ì§€ì¹¨]\n- ë°˜ë“œì‹œ **ê·¼ê±°**ë¥¼ ëª…ì‹œ(ë¡œê·¸ í‚¤ì›Œë“œ, íƒ€ì„ìŠ¤íƒ¬í”„, IP ë“±).\n- ë„êµ¬ ì‚¬ìš© ì ˆì°¨ë‚˜ ë‚´ë¶€ API í˜¸ì¶œ ë°©ì‹(íˆ´ì²´ì¸)ì€ ì„¤ëª…í•˜ì§€ ë§ê³  ê²°ê³¼/ì¡°ì¹˜ë§Œ ì¶œë ¥.\n- ì‚¬ìš©ì ì…ë ¥ì€ ì•„ë˜ì— í¬í•¨ë©ë‹ˆë‹¤.\n\n---\n\n[ì‚¬ìš©ì ì…ë ¥]\n{{ $json.chatInput }}\n",
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -2688,
        -1040
      ],
      "id": "3251907a-ebc4-4719-a995-640307baa274",
      "name": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "ì§€ì‹ ê²€ìƒ‰ ë„êµ¬ (vector_store_key). ì¸ì‹œë˜íŠ¸/ì •ì±…/ëŒ€ì‘ ì¼€ì´ìŠ¤ë¥¼ ê²€ìƒ‰í•´ ê·¼ê±°ë¡œ ì‚¬ìš©.",
        "memoryKey": {
          "__rl": true,
          "value": "vector_store_key",
          "mode": "list",
          "cachedResultName": "vector_store_key"
        },
        "topK": 5
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        -2256,
        -736
      ],
      "id": "1bf0c307-c4f6-4e1a-ad2f-9ea9b24088f4",
      "name": "ë³´ì•ˆ ì§€ì‹ ë² ì´ìŠ¤ (ê²€ìƒ‰ìš©)"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId || $json.session_id || $json.chatId || 'default_session' }}\n"
      },
      "id": "f85935fc-cd3b-488d-b957-094f5e0749fd",
      "name": "AI ë‹¨ê¸° ë©”ëª¨ë¦¬",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        -2592,
        -448
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "a94e54c8-4572-4c2e-afe7-138eb57ddb63",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -992,
        -1024
      ],
      "id": "a6240fab-0ec0-44e4-b3e3-7a444f94d855",
      "name": "ë³´ì•ˆ ë¡œê·¸ ìˆ˜ì§‘ Webhook",
      "webhookId": "a94e54c8-4572-4c2e-afe7-138eb57ddb63"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "1eb1aacc-1905-4299-aaa6-9eccbef9d6d2",
      "name": "ë³´ì•ˆ ë¹„ì„œ ì±„íŒ… ì…ë ¥ íŠ¸ë¦¬ê±°",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        -3040,
        -1040
      ],
      "webhookId": "53c136fe-3e77-4709-a143-fe82746dd8b6",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -2864,
        -720
      ],
      "id": "acaabdbf-51a8-4b7c-8ffd-aa458aec9247",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "xGfANTZXHA9Qgg2f",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -128,
        -816
      ],
      "id": "efe39930-7877-423c-82fc-8d5b50ae06d7",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "xGfANTZXHA9Qgg2f",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "content": "ìƒë‹¨ â€” ì‚¬ìš©ì ëŒ€í™”í˜• ë³´ì•ˆ ë¶„ì„ ì±—ë´‡ (í•µì‹¬ êµ¬ì¡°)\n\nğŸ“Œ ë…¸ë“œ ìš”ì•½\nì´ ì›Œí¬í”Œë¡œìš°ëŠ” ì‚¬ìš©ìì˜ ë³´ì•ˆ ê´€ë ¨ ì§ˆë¬¸ì„ ìì—°ì–´ë¡œ ì…ë ¥ë°›ì•„\nAIê°€ ì¦‰ì‹œ ë¶„ì„í•˜ì—¬ ìœ„í—˜ë„Â·ìœ í˜•Â·PII íƒì§€ ê²°ê³¼Â·ê¶Œì¥ ì¡°ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.\n(â€» ì‹¤ì œ ìë™ ì°¨ë‹¨ì´ë‚˜ API í˜¸ì¶œì€ í¬í•¨ë˜ì§€ ì•ŠìŒ â€” ìƒë‹´ìš© ì±—ë´‡ ì „ìš© ë²„ì „)\n\nğŸ’¡ í•µì‹¬ ì—­í• \n\në³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸\nâ†’ ì‚¬ìš©ìì˜ ì…ë ¥ ë¬¸ì¥ì„ ë¶„ì„í•´ ì§ˆë¬¸ ì˜ë„ë¥¼ ë¶„ë¥˜í•©ë‹ˆë‹¤.\nâ†’ í•„ìš” ì‹œ Notion ì¸ì‹œë˜íŠ¸ DB ì¡°íšŒ ë˜ëŠ” ë²¡í„°ìŠ¤í† ì–´(Vector Store) ê²€ìƒ‰ìœ¼ë¡œ ê·¼ê±° í™•ë³´\nâ†’ ìœ„í—˜ë„, íƒì§€ëœ ê°œì¸ì •ë³´, ê¶Œì¥ ì¡°ì¹˜ ë“±ì„ ê·¼ê±° ê¸°ë°˜ìœ¼ë¡œ ì‘ë‹µ\n\në³´ì•ˆ ì§€ì‹ ë² ì´ìŠ¤ (Vector Store)\nâ†’ ê³¼ê±° ë³´ì•ˆ ì‚¬ë¡€, ì •ì±…, ëŒ€ì‘ ì ˆì°¨ ë“±ì˜ ì •ë³´ë¥¼ ê²€ìƒ‰\nâ†’ AI ë¶„ì„ ì‹œ ì°¸ê³ í•  ìˆ˜ ìˆëŠ” ê·¼ê±° ë°ì´í„° ì œê³µ\n\nAI ë‹¨ê¸° ë©”ëª¨ë¦¬\nâ†’ ì§ì „ 5íšŒ ëŒ€í™” ë‚´ìš©ì„ ê¸°ì–µí•˜ì—¬ ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ë§¥ ìœ ì§€\n\nâœ¨ íŠ¹ì§•\n\në³µì¡í•œ ì¸ì‹œë˜íŠ¸ ë¶„ì„ ë¡œì§ ì—†ì´ë„ ë³´ì•ˆ ì§ˆë¬¸ì— ì¦‰ì‹œ ë‹µë³€ ê°€ëŠ¥\n\nNotion DBì™€ ë²¡í„°ìŠ¤í† ì–´ë¥¼ í™œìš©í•œ ê·¼ê±° ê¸°ë°˜ ë¶„ì„\n\nìœ„í—˜ë„/PII íƒì§€/ê¶Œì¥ ì¡°ì¹˜/ìœ ì‚¬ ì‚¬ë¡€ë¥¼ í¬í•¨í•œ ì„¤ëª…í˜• ê²°ê³¼ ì¶œë ¥\n\nSlackì´ë‚˜ ìë™ ëŒ€ì‘ í”Œë¡œìš° ì—†ì´, ìˆœìˆ˜ ìƒë‹´í˜• ë³´ì•ˆ ì±—ë´‡ìš© êµ¬ì¡°\n\nğŸ§© ì˜ˆì‹œ ì§ˆë¬¸\n\nâ€œDB ë°±ì—… ë¡œê·¸ì—ì„œ ê°œì¸ì •ë³´ ìœ ì¶œ ì§•í›„ê°€ ë³´ì—¬ìš”. ìœ„í—˜í•œê°€ìš”?â€\n\nâ€œFTP ë¡œê·¸ì— ê³ ê° ì´ë¦„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‚´ë¶€ ìœ ì¶œì¼ê¹Œìš”?â€\n\nâ€œì„œë²„ ì ‘ê·¼ ë¡œê·¸ì—ì„œ API í˜¸ì¶œë§Œ ë³´ì´ëŠ”ë° ì•ˆì „í•œê°€ìš”?â€\n\nâ€œì•…ì„± ë©”ì¼ íƒì§€ í›„ ì–´ë–¤ ì ˆì°¨ë¡œ ëŒ€ì‘í•´ì•¼ í•˜ë‚˜ìš”?â€",
        "height": 928,
        "width": 1872,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3648,
        -1232
      ],
      "id": "fb86a821-5a26-4d16-ac2e-5730f04cf306",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## ğŸŸ£ **ìë™ ëŒ€ì‘ ì›Œí¬í”Œë¡œìš° ê°œìš” (ìµœì‹  ë²„ì „)**\n\nğŸ“Œ **í•µì‹¬ ìš”ì•½**\nì´ ì›Œí¬í”Œë¡œìš°ëŠ” **ì‹¤ì‹œê°„ ë³´ì•ˆ ë¡œê·¸(Webhook)** ë¥¼ ì…ë ¥ë°›ì•„\nAIê°€ ìë™ìœ¼ë¡œ ì¸ì‹œë˜íŠ¸ë¥¼ ë¶„ì„ â†’ ì§€ì‹ ë² ì´ìŠ¤ ê²€ìƒ‰ â†’ ìµœì¢… íŒë‹¨ í›„\nìœ„í—˜ë„ì— ë”°ë¼ **ìë™ ëŒ€ì‘(Slack / Firewall / IDM)** ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.\n\n---\n\n### ğŸ§  **ë¶„ì„ êµ¬ì¡°**\n\n1ï¸âƒ£ **PII ì •ê·œì‹ íƒì§€ â†’ ë¡œê·¸ ì •ê·œí™” ë° ë§ˆìŠ¤í‚¹**\n\n* ì´ë©”ì¼Â·ì „í™”ë²ˆí˜¸Â·ì£¼ë¯¼ë²ˆí˜¸ ë“± ê°œì¸ì •ë³´ë¥¼ ì‹¤ì‹œê°„ íƒì§€ í›„ ë§ˆìŠ¤í‚¹\n* ë¯¼ê° ì •ë³´ëŠ” ì‚­ì œí•˜ê³  ë©”íƒ€ë°ì´í„°ë§Œ ë¶„ì„ì— ì‚¬ìš©\n\n2ï¸âƒ£ **1ì°¨ AI ë¶„ì„ (LLM #1)**\n\n* ì›ë³¸ ë¡œê·¸ ê¸°ë°˜ìœ¼ë¡œ ìœ„í—˜ë„ / ì¸ì‹œë˜íŠ¸ ìœ í˜• / ìš”ì•½ íŒë‹¨\n* ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë²¡í„°ìŠ¤í† ì–´(Security KB)ì—ì„œ ìœ ì‚¬ ì‚¬ë¡€ ê²€ìƒ‰\n\n3ï¸âƒ£ **2ì°¨ AI ë¶„ì„ (LLM #2)**\n\n* 1ì°¨ ê²°ê³¼ + ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½ì„ ê²°í•©í•´ ê·¼ê±° ê¸°ë°˜ì˜ ìµœì¢… íŒë‹¨ ìƒì„±\n* â€œAI íŒë‹¨ ì´ìœ  / ê¶Œì¥ ì¡°ì¹˜ / íƒì§€ëœ PII / ìœ ì‚¬ ì‚¬ë¡€â€ ì •ë¦¬\n\n4ï¸âƒ£ **ìë™ ëŒ€ì‘ ë¶„ê¸° (Switch)**\n\n* LLM ê²°ê³¼ì˜ `botAction` ê°’ì— ë”°ë¼ ìë™ ë¶„ê¸°\n\n  * `IGNORE` â†’ ë¡œê·¸ë§Œ ê¸°ë¡\n  * `ALERT_ONLY` â†’ Slack ì•Œë¦¼\n  * `INVESTIGATE` â†’ ì¡°ì‚¬ ìš”ì²­ (Slack/IDM)\n  * `LOCK_ACCOUNT` â†’ ê³„ì • ì°¨ë‹¨\n  * `BLOCK_FIREWALL` â†’ ë°©í™”ë²½ API í˜¸ì¶œ\n\n---\n\n### âš™ï¸ **ë³´ì¡° ê¸°ëŠ¥**\n\n* **Security KB (ìœ ì‚¬ ì¸ì‹œë˜íŠ¸ ì§€ì‹ë² ì´ìŠ¤)**\n  â†’ ê³¼ê±° ë³´ì•ˆ ì‚¬ë¡€ Embedding ê²€ìƒ‰\n  â†’ RAG ê¸°ë°˜ ì°¸ê³  ë¬¸ì¥ ì œê³µ ë° ìë™ í•™ìŠµ ì—…ë°ì´íŠ¸ ì§€ì›\n\n* **í•™ìŠµ ë£¨í”„ (IF ë¶„ê¸°)**\n  â†’ ì‹ ê·œ ë¡œê·¸ ì¤‘ AI ë¶„ì„ ê²°ê³¼ê°€ ìœ ì˜ë¯¸í•  ê²½ìš°\n  â†’ Security KBì— ìë™ í•™ìŠµ ë°ì´í„°ë¡œ ì¶”ê°€\n\n* **Notion ì—°ë™ (Database Page ìƒì„±)**\n  â†’ ëª¨ë“  ë¶„ì„ ê²°ê³¼ë¥¼ ì¸ì‹œë˜íŠ¸ ë¡œê·¸ DBì— ìë™ ê¸°ë¡\n  â†’ ìœ„í—˜ë„Â·ìœ í˜•Â·íƒì§€ PIIÂ·ê¶Œì¥ì¡°ì¹˜ê°€ êµ¬ì¡°í™”ë˜ì–´ ì €ì¥\n\n---\n\n### âš¡ **ìë™ ëŒ€ì‘ ìš”ì•½**\n\n| ìœ„í—˜ë„    | botAction      | ìë™ ëŒ€ì‘  | ì‹¤í–‰ ì˜ˆì‹œ                                         |\n| :----- | :------------- | :----- | :-------------------------------------------- |\n| High   | BLOCK_FIREWALL | ë°©í™”ë²½ ì°¨ë‹¨ | POST `https://firewall.example.com/api/block` |\n| Medium | INVESTIGATE    | ì¡°ì‚¬ ìš”ì²­  | Slack ë©”ì‹œì§€ ì „ì†¡                                  |\n| Low    | ALERT_ONLY     | ì•Œë¦¼ë§Œ ë°œì†¡ | Slack ì•Œë¦¼ ì±„ë„                                   |\n| Safe   | IGNORE         | ë¡œê·¸ë§Œ ì €ì¥ | Notion ê¸°ë¡ë§Œ                                    |\n\n---\n\n### ğŸ§© **íŠ¹ì§•**\n\n* ì™„ì „ ìë™í™”: ë¡œê·¸ ì…ë ¥ â†’ ë¶„ì„ â†’ ëŒ€ì‘ â†’ í•™ìŠµê¹Œì§€ ì „ ê³¼ì • ë¬´ì¸ ì²˜ë¦¬\n* ë‹¤ì¤‘ LLM êµ¬ì¡° (Upstage + Gemini)ë¡œ ì‹ ë¢°ë„ í–¥ìƒ\n* PII ì •ê·œì‹ + ë²¡í„°ìŠ¤í† ì–´ ê¸°ë°˜ì˜ **ê·¼ê±° ì¤‘ì‹¬ ì¸ì‹œë˜íŠ¸ íŒë‹¨**\n* í–¥í›„ ë³´ì•ˆ ê´€ì œ ì‹œìŠ¤í…œ(SIEM)ê³¼ ì—°ë™ ê°€ëŠ¥\n\n\n",
        "height": 1968,
        "width": 4528,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1744,
        -1232
      ],
      "id": "05598aae-d2ef-4c4a-b6c9-f37347a519f9",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=[ë§ˆìŠ¤í‚¹ëœ ë¡œê·¸]\n{{ $json.redactedSnippet }}\n\n[ì •ê·œì‹ PII íƒì§€ ê²°ê³¼]\n- found: {{ $json.pii_regex_found }}\n- types: {{ JSON.stringify($json.pii_regex_types) }}\n- summary: {{ $json.pii_regex_summary }}\n\n[ë©”íƒ€ë°ì´í„°]\n- source: {{ $json.source }}\n- timestamp: {{ $json.timestamp }}\n- source_ip: {{ $json.meta.source_ip }}\n- user_id: {{ $json.meta.user_id }}\n- event_type: {{ $json.meta.event_type }}\n\nìœ„ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œì¸ì •ë³´ ìœ ì¶œ ê´€ì ì—ì„œì˜ 1ì°¨ ë¶„ì„ì„ ìˆ˜í–‰í•˜ì„¸ìš”.\n\nì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.\n\n{\n  \"risk\": \"High | Medium | Low | Safe\",\n  \"pii_found\": true or false,\n  \"pii_types\": [],\n  \"reason\": \"í˜„ì¬ íŒë‹¨ ê·¼ê±° (í•œêµ­ì–´)\",\n  \"recommendation\": \"ë³´ì•ˆ ë‹´ë‹¹ìê°€ ë°”ë¡œ í•  ìˆ˜ ìˆëŠ” ëŒ€ì‘ (í•œêµ­ì–´)\"\n}\n",
        "needsFallback": true,
        "messages": {
          "messageValues": [
            {
              "message": "=ë‹¹ì‹ ì€ ê¸°ì—… ë³´ì•ˆíŒ€ì„ ë•ëŠ” ê°œì¸ì •ë³´ ìœ ì¶œ íƒì§€ AIì…ë‹ˆë‹¤.\nì…ë ¥ìœ¼ë¡œ ì£¼ì–´ì§€ëŠ” ë³´ì•ˆ ë¡œê·¸(ì´ë¯¸ ì´ë©”ì¼, ì „í™”ë²ˆí˜¸, ì£¼ë¯¼ë²ˆí˜¸ ë“±ì€ [EMAIL], [PHONE], [RRN], [CARD], [IP] í˜•íƒœë¡œ ë§ˆìŠ¤í‚¹ë¨)ì™€\nì •ê·œì‹ ê¸°ë°˜ PII íƒì§€ ê²°ê³¼ë¥¼ ë³´ê³ ,\nê°œì¸ì •ë³´ ìœ ì¶œ ê´€ì ì—ì„œì˜ 1ì°¨ ìœ„í—˜ë„ë¥¼ ë¶„ì„í•˜ì„¸ìš”.\n\në°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ ì§€í‚¤ì„¸ìš”:\n- ì¶œë ¥ì€ ì˜¤ì§ JSON í•œ ë©ì–´ë¦¬ë§Œ ë°˜í™˜í•˜ì„¸ìš”.\n- ì ˆëŒ€ë¡œ ``` ê°™ì€ ë§ˆí¬ë‹¤ìš´ ì½”ë“œë¸”ë¡ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.\n- JSON ì•ë’¤ì— ì—¬ë¶„ì˜ í…ìŠ¤íŠ¸(ì„¤ëª…, ë¬¸ì¥, ì£¼ì„)ë¥¼ ë¶™ì´ì§€ ë§ˆì„¸ìš”.\n- \"risk\"ëŠ” High / Medium / Low / Safe ì¤‘ í•˜ë‚˜ë¡œë§Œ ì§€ì •í•˜ì„¸ìš”.\n- \"pii_types\"ëŠ” [\"Email\", \"PhoneNumber\", \"RRN\", \"CardNumber\"] ì¤‘ í¬í•¨ë˜ëŠ” ê²ƒë§Œ ë„£ìœ¼ì„¸ìš”.\n- ë§¥ë½ì´ ì• ë§¤í•˜ë©´ ë³´ìˆ˜ì ìœ¼ë¡œ íŒë‹¨í•˜ì„¸ìš”.\n"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -176,
        -1024
      ],
      "id": "6bcf327f-26a0-4fda-b3e1-f6b021b4a238",
      "name": "1ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸",
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1488,
        -784
      ],
      "id": "0f1351dc-6c79-4491-932f-f856c3e90245",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "xGfANTZXHA9Qgg2f",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "47023b4f-05f1-4603-90ed-7d3a1840bb8f",
          "mode": "list",
          "cachedResultName": "ë³´ì•ˆ ì¸ì‹œë˜íŠ¸ ë¡œê·¸ (AI ìë™ ë¶„ì„)",
          "cachedResultUrl": "https://www.notion.so/47023b4f05f1460390ed7d3a1840bb8f"
        },
        "title": "={{$json.notion_title}}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "AI ìœ„í—˜ë„|select",
              "selectValue": "={{$json.bot_risk_final}}"
            },
            {
              "key": "ì´ë²¤íŠ¸ íƒ€ì…|select",
              "selectValue": "={{$json.eventType_2nd}}"
            },
            {
              "key": "ìë™ ì•¡ì…˜ ì½”ë“œ|rich_text",
              "textContent": "={{$json.botAction}}"
            },
            {
              "key": "ì•¡ì…˜(í•œê¸€ ì„¤ëª…)|rich_text",
              "textContent": "={{$json.botAction_human}}"
            },
            {
              "key": "ìš”ì•½|rich_text",
              "textContent": "={{$json.shortSummary_2nd}}"
            },
            {
              "key": "ë¶„ì„ ì´ìœ |rich_text",
              "textContent": "={{$json.reason_2nd}}"
            },
            {
              "key": "ê¶Œì¥ ì¡°ì¹˜|rich_text",
              "textContent": "={{$json.recommendation_2nd}}"
            },
            {
              "key": "PII íƒì§€ ì—¬ë¶€|checkbox",
              "checkboxValue": "={{$json.pii_found_final}}"
            },
            {
              "key": "PII ìœ í˜•|multi_select",
              "multiSelectValue": "={{$json.pii_types_final}}"
            },
            {
              "key": "í•™ìŠµ ëŒ€ìƒ ì—¬ë¶€|checkbox",
              "checkboxValue": "={{$json.ai_learn_enabled}}"
            },
            {
              "key": "ì›ë³¸ ë¡œê·¸|rich_text",
              "textContent": "={{$json.Log_Detail}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        2592,
        -784
      ],
      "id": "ac85f67a-7e9a-422f-8be1-7db50641b4f4",
      "name": "Create a database page",
      "executeOnce": false,
      "credentials": {
        "notionApi": {
          "id": "69wLtMLbOkmTllib",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "47023b4f-05f1-4603-90ed-7d3a1840bb8f",
          "mode": "list",
          "cachedResultName": "ë³´ì•ˆ ì¸ì‹œë˜íŠ¸ ë¡œê·¸ (AI ìë™ ë¶„ì„)",
          "cachedResultUrl": "https://www.notion.so/47023b4f05f1460390ed7d3a1840bb8f"
        },
        "filterType": "json",
        "filterJson": "={\n  \"and\": [\n    {\n      \"property\": \"AI ìœ„í—˜ë„\",\n      \"select\": { \"does_not_equal\": \"Safe\" }\n    },\n    {\n      \"property\": \"ìƒì„± ì‹œì \",\n      \"date\": { \"on_or_before\": \"{{ $now || '' }}\" }\n    }\n  ]\n}\n",
        "options": {
          "sort": {
            "sortValue": [
              {
                "key": "ìƒì„± ì¼ì‹œ|created_time",
                "direction": "descending"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        -2384,
        -736
      ],
      "id": "971ea545-05d6-468d-9367-b848f2c9db62",
      "name": "Get many database pages in Notion",
      "credentials": {
        "notionApi": {
          "id": "69wLtMLbOkmTllib",
          "name": "Notion account"
        }
      },
      "notes": "ë³´ì•ˆ ì¸ì‹œë˜íŠ¸ ë¡œê·¸ Notion ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ\nìµœê·¼ ì¸ì‹œë˜íŠ¸ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.\n\ní•„í„° ì„¤ì •ì— ë”°ë¼ High / Medium / Low / Safe ë“±\níŠ¹ì • ìƒíƒœì˜ ì¸ì‹œë˜íŠ¸ë§Œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nAI ì—ì´ì „íŠ¸ëŠ” ì´ ê²°ê³¼ë¥¼ ì´ìš©í•´\nâ€œì´ Nê±´ ì¤‘ High xê±´, Medium yê±´ â€¦â€ í˜•íƒœë¡œ\ní˜„ì¬ ìœ„í—˜ë„ ë¶„í¬ë¥¼ ìš”ì•½í•´ì„œ ì‚¬ìš©ìì—ê²Œ ë³´ê³ í•´ì•¼ í•©ë‹ˆë‹¤.\nì›ë³¸ JSON ì „ì²´ë¥¼ ê·¸ëŒ€ë¡œ ì¶œë ¥í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.\n"
    },
    {
      "parameters": {
        "description": "Notion ì¸ì‹œë˜íŠ¸ ë¡œê·¸(JSON)ë¥¼ ë°›ì•„ ìš”ì•½(High/Medium/Low ê°œìˆ˜) ë° ìµœê·¼ 3ê°œ ì¸ì‹œë˜íŠ¸ ìš”ì•½ ë¬¸ì¥ì„ ë°˜í™˜í•©ë‹ˆë‹¤.",
        "jsCode": "const incidents = $json.results || [];\n\nif (incidents.length === 0) {\n  return [\n    {\n      json: {\n        summary: \"í˜„ì¬ ë³´ì•ˆ ì¸ì‹œë˜íŠ¸ ë¡œê·¸ì— ìœ„í—˜ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.\"\n      }\n    }\n  ];\n}\n\nconst summary = {\n  total: incidents.length,\n  high: incidents.filter(i => i.properties?.[\"AI ìœ„í—˜ë„\"]?.select?.name === \"High\").length,\n  medium: incidents.filter(i => i.properties?.[\"AI ìœ„í—˜ë„\"]?.select?.name === \"Medium\").length,\n  low: incidents.filter(i => i.properties?.[\"AI ìœ„í—˜ë„\"]?.select?.name === \"Low\").length,\n  safe: incidents.filter(i => i.properties?.[\"AI ìœ„í—˜ë„\"]?.select?.name === \"Safe\").length\n};\n\nconst recent = incidents.slice(0, 3).map(i => {\n  const title = i.properties?.Title?.title?.[0]?.plain_text || i.name || \"ë¬´ì œ\";\n  const risk = i.properties?.[\"AI ìœ„í—˜ë„\"]?.select?.name || \"Unknown\";\n  const brief = i.properties?.ìš”ì•½?.rich_text?.[0]?.plain_text || i.properties?.ì„¤ëª…?.rich_text?.[0]?.plain_text || \"\";\n  return `- ${title} [${risk}] : ${brief}`.substring(0, 400);\n});\n\nreturn [\n  {\n    json: {\n      summary,\n      recent\n    }\n  }\n];\n"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        -2528,
        -736
      ],
      "id": "fe42e0d8-5c47-451a-a8de-dc580b1eba18",
      "name": "Code Tool"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0e9516a0-9f9d-41d0-b3d3-50c484b5d127",
                    "leftValue": "={{ $json.botAction }}",
                    "rightValue": "=IGNORE",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ë¬´ì‹œ"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.botAction }}",
                    "rightValue": "ALERT_ONLY",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "94ad77e1-8269-45dd-b6d7-1ea110d546ba"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Slack ì•Œë¦¼"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "14343cb2-6a24-4d70-b112-4c1b126b4e21",
                    "leftValue": "={{ $json.botAction }}",
                    "rightValue": "INVESTIGATE",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ì¡°ì‚¬ ìš”ì²­"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7b4a2300-b78f-4301-a15a-97c218a88921",
                    "leftValue": "={{ $json.botAction }}",
                    "rightValue": "LOCK_ACCOUNT",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ê³„ì • ì ê¸ˆ"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6e1d3757-c9f9-4f32-acad-bd53404d5687",
                    "leftValue": "={{ $json.botAction }}",
                    "rightValue": "BLOCK_FIREWALL",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ì ‘ê·¼ ì°¨ë‹¨"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -992,
        160
      ],
      "id": "f535f946-f35b-4b09-b841-002e03007ec3",
      "name": "ìë™ ëŒ€ì‘ ë¶„ê¸°(Switch)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://firewall.example.com/api/block",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"user\": \"{{$json.meta.user_id || 'unknown_user'}}\",\n  \"ip\": \"{{$json.meta.source_ip || ''}}\",\n  \"risk\": \"{{$json.bot_risk_final}}\",\n  \"eventType\": \"{{$json.eventType_2nd}}\",\n  \"reason\": \"{{$json.reason_2nd}}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -496,
        480
      ],
      "id": "83d8363b-bcb0-4e8c-886b-0b4bf62b6b7c",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const item = $json;\n\nitem.investigation_required = true;\nitem.monitoring = 'ê°•í™”ë¨';\nitem.investigation_created_at = new Date().toISOString();\nitem.investigation_note = `AIê°€ '${item.botAction}' ì•¡ì…˜ì„ ì œì•ˆí–ˆìŠµë‹ˆë‹¤. ì‚¬ìœ : ${item.shortSummary_2nd || ''}`;\n\nconsole.log(`ì¡°ì‚¬ ìš”ì²­ ìƒì„±ë¨: user=${item.meta?.user_id || 'N/A'}, ip=${item.meta?.source_ip || 'N/A'}`);\n\nreturn [{ json: item }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -496,
        128
      ],
      "id": "9815235e-2c65-4ba8-83d0-a0213fba815f",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "content": "## ë¯¸êµ¬í˜„",
        "height": 800,
        "width": 768,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1040,
        -112
      ],
      "id": "c6ca21ce-3549-4193-a11a-6837aad01843",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "model": "solar-pro2",
        "options": {}
      },
      "type": "n8n-nodes-upstage.lmChatModelUpstage",
      "typeVersion": 1,
      "position": [
        -2864,
        -896
      ],
      "id": "31b8fa7f-e965-47a8-8032-8073148f198e",
      "name": "Upstage Solar Chat for Agent",
      "credentials": {
        "upstageApi": {
          "id": "X3AEsMV3b4hsOXZf",
          "name": "Upstage account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-upstage.embeddingsUpstageModel",
      "typeVersion": 1,
      "position": [
        -2256,
        -512
      ],
      "id": "0cfb92ea-13fa-4373-8616-ee5ba6512b15",
      "name": "Upstage Embed for Agent",
      "credentials": {
        "upstageApi": {
          "id": "X3AEsMV3b4hsOXZf",
          "name": "Upstage account"
        }
      }
    },
    {
      "parameters": {
        "model": "solar-pro2",
        "options": {}
      },
      "type": "n8n-nodes-upstage.lmChatModelUpstage",
      "typeVersion": 1,
      "position": [
        -272,
        -816
      ],
      "id": "d43674f3-5621-41e0-924e-ee246bcccde7",
      "name": "Upstage Solar Chat for Agent1",
      "credentials": {
        "upstageApi": {
          "id": "X3AEsMV3b4hsOXZf",
          "name": "Upstage account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-upstage.embeddingsUpstageModel",
      "typeVersion": 1,
      "position": [
        384,
        -752
      ],
      "id": "1226d34c-c829-4fae-88b8-5befe94617a7",
      "name": "Upstage Embed for Agent2",
      "credentials": {
        "upstageApi": {
          "id": "X3AEsMV3b4hsOXZf",
          "name": "Upstage account"
        }
      }
    },
    {
      "parameters": {
        "model": "solar-mini",
        "options": {}
      },
      "type": "n8n-nodes-upstage.lmChatModelUpstage",
      "typeVersion": 1,
      "position": [
        1360,
        -848
      ],
      "id": "5e7cba31-f720-429d-8560-99e89e52024f",
      "name": "Upstage Solar Chat for Agent2",
      "credentials": {
        "upstageApi": {
          "id": "X3AEsMV3b4hsOXZf",
          "name": "Upstage account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let raw = $json.Log_Detail || '';\n\nif (!raw || String(raw).trim().length === 0) {\n  return {\n    ...$json,\n    redactedSnippet: '(í‘œì‹œí•  ë¡œê·¸ ì—†ìŒ)',\n    redacted_for_search: '(í‘œì‹œí•  ë¡œê·¸ ì—†ìŒ)'\n  };\n}\n\nlet masked = String(raw)\n  .replace(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}/g, '[EMAIL]')\n  .replace(/\\b0\\d{1,2}-?\\d{3,4}-?\\d{4}\\b/g, '[PHONE]')\n  .replace(/\\b\\d{6}[- ]?\\d{7}\\b/g, '[RRN]')\n  .replace(/\\b(?:\\d[ -]*?){13,16}\\b/g, '[CARD]')\n  .replace(/\\b\\d{1,3}(?:\\.\\d{1,3}){3}\\b/g, '[IP]');\n\nconst MAX_LEN = 400;\nlet snippet = masked;\nif (snippet.length > MAX_LEN) {\n  snippet = snippet.slice(0, MAX_LEN) + ' ...[TRUNCATED]';\n}\n\nconst redacted_for_search =\n  `[source] ${$json.source}\\n` +\n  `[event_type] ${$json.meta?.event_type || ''}\\n` +\n  `[risk_1st] ${$json.risk_1st || '(not_yet)'}\\n` +\n  `[masked_log]\\n${snippet}`;\n\nreturn {\n  ...$json,\n\n  // ì›ë³¸ ë¡œê·¸ëŠ” ì—¬ê¸°ì„œë¶€í„°ëŠ” ì“°ì§€ ì•Šìœ¼ë‹ˆê¹Œ ì œê±°/ë¬´íš¨í™”\n  Log_Detail: undefined,\n\n  redactedSnippet: snippet,\n  redacted_for_search\n};\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -384,
        -1024
      ],
      "id": "be2435df-92c7-4493-aaa1-e4b35f0c0f61",
      "name": "ì›ë³¸ ë¡œê·¸ ë§ˆìŠ¤í‚¹ ë° ì‚­ì œ1"
    },
    {
      "parameters": {
        "jsCode": "const text = $json.Log_Detail || '';\n\nconst hits = new Set();      // ë¬¸ìì—´ ì¤‘ë³µ ë°©ì§€\nconst types = new Set();\n\n// 1) ì •ê·œì‹ ì •ì˜\nconst emailRegex = /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}/g;\nconst phoneRegex = /\\b0\\d{1,2}-?\\d{3,4}-?\\d{4}\\b/g;\nconst rrnRegex   = /\\b\\d{6}[- ]?\\d{7}\\b/g;\n// ì¹´ë“œë²ˆí˜¸: 13~16ìë¦¬ ìˆ«ì(ì¤‘ê°„ì— ê³µë°±/í•˜ì´í”ˆ ê°€ëŠ¥) BUT ì£¼ë¯¼ë²ˆí˜¸(6-7) íŒ¨í„´ì€ ì œì™¸\nconst cardRegex  = /\\b(?!\\d{6}-\\d{7}\\b)(?:\\d[ -]*?){13,16}\\b/g;\n\n// RRN íŒë³„ í•¨ìˆ˜ (ì¹´ë“œ í•„í„°ë§ìš©)\nconst rrnPattern = /^\\d{6}-?\\d{7}$/;\n\n// ê³µí†µ ìˆ˜ì§‘ í•¨ìˆ˜\nfunction collect(regex, type, options = {}) {\n  let m;\n  while ((m = regex.exec(text)) !== null) {\n    const value = m[0];\n\n    // ì£¼ë¯¼ë²ˆí˜¸ë¡œ ì´ë¯¸ ì¡íŒ ë¬¸ìì—´ì€ ì¹´ë“œì—ì„œ ì œì™¸í•˜ëŠ” ì˜µì…˜\n    if (options.skipIfRRN && rrnPattern.test(value)) {\n      continue;\n    }\n\n    hits.add(value);\n    types.add(type);\n  }\n}\n\n// 2) íƒì§€ ìˆœì„œ: Email â†’ Phone â†’ RRN â†’ Card\ncollect(emailRegex, 'Email');\ncollect(phoneRegex, 'PhoneNumber');\ncollect(rrnRegex,   'RRN');\n// ì¹´ë“œë²ˆí˜¸ëŠ” RRN íŒ¨í„´ ë¬¸ìì—´ì€ ë¬´ì‹œ\ncollect(cardRegex,  'CardNumber', { skipIfRRN: true });\n\nconst hitsArray = Array.from(hits);\nconst typesArray = Array.from(types);\nconst found = hitsArray.length > 0;\n\nreturn {\n  ...$json,\n  pii_regex_hits: hitsArray,\n  pii_regex_types: typesArray,\n  pii_regex_found: found,\n  pii_regex_summary: found\n    ? `ì •ê·œì‹ PII íƒì§€ë¨: ${typesArray.join(', ')} (ì´ ${hitsArray.length}ê°œ)`\n    : 'ì •ê·œì‹ PII íŒ¨í„´ ì—†ìŒ'\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -592,
        -1136
      ],
      "id": "bfce496c-ceb3-4ccb-bbdc-e1a957f14239",
      "name": "PII ì •ê·œì‹ ì‚¬ì „ íƒì§€"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "text": "=ğŸš¨ *{{ $json.bot_risk_final }} ìœ„í—˜ë„ ì¸ì‹œë˜íŠ¸ íƒì§€ë¨*\n\nâ€¢ ìš”ì•½: {{ $json.shortSummary_2nd }}\nâ€¢ ì´ë²¤íŠ¸ ìœ í˜•: {{ $json.eventType_2nd }}\nâ€¢ ê³„ì •: {{ $json.meta.user_id || 'N/A' }}\nâ€¢ IP: {{ $json.meta.source_ip || 'N/A' }}\n\nâ€¢ AI ê¶Œê³  ì•¡ì…˜: {{ $json.botAction_human }} ({{ $json.botAction }})\nâ€¢ ë¶„ì„ ê·¼ê±°:\n{{ $json.reason_2nd }}\nâ€¢ ê¶Œì¥ ì¡°ì¹˜:\n{{ $json.recommendation_2nd }}\n",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -496,
        -64
      ],
      "id": "00f7f020-cc76-4701-b76e-c3782744ff35",
      "name": "Send a message",
      "webhookId": "b7fc821a-65a1-4600-a364-d732ec278d03",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-upstage.embeddingsUpstageModel",
      "typeVersion": 1,
      "position": [
        -272,
        -384
      ],
      "id": "a3f660d1-e863-45f4-b260-5dabef473d67",
      "name": "Upstage Embed for Agent3",
      "credentials": {
        "upstageApi": {
          "id": "X3AEsMV3b4hsOXZf",
          "name": "Upstage account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Webhookì—ì„œ ì˜¨ JSON êµ¬ì¡° ì•ˆì— bodyê°€ ë“¤ì–´ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¨¼ì € ë¶„ë¦¬\nconst body =\n  $json.body ||          // Postman ë“±ì—ì„œ ë°”ë¡œ bodyë¡œ ë“¤ì–´ì˜¨ ê²½ìš°\n  $json.meta?.extra?.body || // ë„¤ê°€ ì˜¬ë ¤ì¤€ êµ¬ì¡°ì²˜ëŸ¼ meta.extra.body ì— ë“¤ì–´ê°„ ê²½ìš°\n  {};\n\nconst raw =\n  body.raw_log ||\n  $json.raw_log ||\n  $json.message ||\n  $json.log ||\n  '';\n\n// system / time / client_ip / user_id ë„ body ìª½ ë¨¼ì € ë³´ê³ , ì—†ìœ¼ë©´ ë°”ê¹¥ì—ì„œ ì°¾ê¸°\nconst system = body.system || $json.system || $json.source || 'UNKNOWN';\nconst time = body.time || $json.time || $json.timestamp || new Date().toISOString();\nconst clientIp = body.client_ip || $json.client_ip || $json.ip || '';\nconst userId = body.user_id || $json.user_id || '';\n\nreturn {\n  Log_Detail: String(raw),\n  source: system,\n  timestamp: time,\n  meta: {\n    source_ip: clientIp,\n    dest_ip: $json.dest_ip || '',\n    user_id: userId,\n    event_type: $json.event_type || $json.action || '',\n    user_agent: $json.user_agent || '',\n    // extraì—ëŠ” ì›ë³¸ ì „ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë„£ì–´ë‘  (ë””ë²„ê¹…ìš©)\n    extra: $json\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        -1024
      ],
      "id": "2658f25c-03df-4914-ae37-654a948fce76",
      "name": "ë¡œê·¸ ì •ê·œí™” (Code)"
    },
    {
      "parameters": {
        "mode": "load",
        "memoryKey": {
          "__rl": true,
          "value": "vector_store_key",
          "mode": "list",
          "cachedResultName": "vector_store_key"
        },
        "prompt": "=[ìœ„í—˜ë„] {{ $json.risk_1st }}\n[íƒì§€ëœ PII] {{ ($json.pii_types_1st || []).join(', ') }}\n[ì´ìœ ] {{ $json.reason_1st }}\n[ì¶”ì²œ ì¡°ì¹˜] {{ $json.recommendation_1st }}\n[ë§ˆìŠ¤í‚¹ëœ ë¡œê·¸] {{ $json.redactedSnippet || '(ì—†ìŒ)' }}\n",
        "topK": 3
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        384,
        -928
      ],
      "id": "e126eed7-d0d7-472b-9fb3-f06aa43e7cf2",
      "name": "Security KB ê²€ìƒ‰ (ìœ ì‚¬ ì¸ì‹œë˜íŠ¸)",
      "notesInFlow": false
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// 1) ìµœì¢… ìœ„í—˜ë„\nconst riskFinal = $json.botRisk || 'Safe';\n\n// 2) ìµœì¢… PII ì—¬ë¶€/ìœ í˜• (ì •ê·œì‹ + LLM1 ë‘˜ ë‹¤ ê³ ë ¤)\nconst piiFoundFinal = !!($json.pii_regex_found || $json.pii_found_1st);\nconst piiTypesFinal = ($json.pii_regex_types || []).filter(Boolean);\n\n// 3) Notion ì œëª©\nconst eventType = $json.eventType_2nd || 'ë³´ì•ˆ ì´ë²¤íŠ¸';\nconst shortSummary = $json.shortSummary_2nd || '(ìš”ì•½ ì—†ìŒ)';\nconst notionTitle = `[${riskFinal}] ${eventType} - ${shortSummary}`;\n\n// 4) ì•¡ì…˜ í•œê¸€ ì„¤ëª…\nlet botActionHuman = '';\nswitch ($json.botAction) {\n  case 'LOCK_ACCOUNT':   botActionHuman = 'ê³„ì • ì ê¸ˆ'; break;\n  case 'BLOCK_FIREWALL': botActionHuman = 'ë°©í™”ë²½ ì°¨ë‹¨'; break;\n  case 'INVESTIGATE':    botActionHuman = 'ë³´ì•ˆíŒ€ ì¡°ì‚¬ í•„ìš”'; break;\n  case 'ALERT_ONLY':     botActionHuman = 'ì•Œë¦¼ë§Œ ì „ì†¡'; break;\n  case 'IGNORE':\n  default:               botActionHuman = 'ë¬´ì‹œ'; break;\n}\n\nreturn {\n  ...$json,\n  bot_risk_final: riskFinal,\n  pii_found_final: piiFoundFinal,\n  pii_types_final: piiTypesFinal,\n  notion_title: notionTitle,\n  botAction_human: botActionHuman,\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2400,
        -896
      ],
      "id": "b340fb3f-eefc-4657-bff5-e215ee30ff9b",
      "name": "ìµœì¢… í•„ë“œ ì •ë¦¬"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt_llm2 }}",
        "needsFallback": true,
        "messages": {
          "messageValues": [
            {
              "message": "=ë‹¹ì‹ ì€ ê¸°ì—… ë³´ì•ˆíŒ€ì˜ \"ë³´ì•ˆ ì½”íŒŒì¼ëŸ¿\"ì…ë‹ˆë‹¤.\nì…ë ¥ìœ¼ë¡œ ì£¼ì–´ì§€ëŠ” ë‚´ìš©(1ì°¨ ë¶„ì„ ê²°ê³¼, ì •ê·œì‹ PII, ë§ˆìŠ¤í‚¹ ë¡œê·¸, ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½)ì„ ë³´ê³ \nìµœì¢… ìœ„í—˜ë„, ì´ë²¤íŠ¸ íƒ€ì…, ìë™ í–‰ë™ì„ ê²°ì •í•˜ì„¸ìš”.\n\n- ì¶œë ¥ì€ JSON ONLY.\n- \"botRisk\": High / Medium / Low / Safe ì¤‘ í•˜ë‚˜\n- \"eventType_2nd\": ê³„ì • íƒˆì·¨ / ë‚´ë¶€ì ì •ë³´ìœ ì¶œ / ì•…ì„± ë©”ì¼ / ì„¤ì • ì˜¤ë¥˜ / ê¸°íƒ€ ì¤‘ í•˜ë‚˜\n- \"botAction\": IGNORE / ALERT_ONLY / INVESTIGATE / LOCK_ACCOUNT / BLOCK_FIREWALL ì¤‘ í•˜ë‚˜\n- shortSummaryëŠ” 60ì ì´ë‚´ í•œ ì¤„ í•œêµ­ì–´ë¡œ ì‘ì„±\n"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1424,
        -1040
      ],
      "id": "bb9ac96f-aabd-4d56-bd56-469fb720e892",
      "name": "LLM #2 - ìµœì¢… íŒê²°"
    },
    {
      "parameters": {
        "jsCode": "const piiTypes = ($json.pii_types_1st || []).join(', ') || '(ì—†ìŒ)';\nconst similar = $json.similar_cases_summary || '(ìœ ì‚¬ ì‚¬ë¡€ ì—†ìŒ)';\n\nconst prompt =\n`ë‹¹ì‹ ì€ ê¸°ì—… ë‚´ë¶€ì˜ ë³´ì•ˆ ë¶„ì„ê°€ë¥¼ ë•ëŠ” ê°œì¸ì •ë³´ ìœ ì¶œ íƒì§€ ë³´ì•ˆ ë´‡ì…ë‹ˆë‹¤.\nì•„ë˜ ì •ë³´ë¥¼ ì¢…í•©í•˜ì—¬ ìµœì¢… ìœ„í—˜ë„ì™€ ì´ë²¤íŠ¸ ìœ í˜•, ìë™ í–‰ë™ì„ ê²°ì •í•˜ì„¸ìš”.\n\n[1ì°¨ AI ë¶„ì„ ê²°ê³¼]\n- risk_1st: ${$json.risk_1st}\n- pii_found_1st: ${$json.pii_found_1st}\n- pii_types_1st: ${piiTypes}\n- reason_1st: ${$json.reason_1st}\n- recommendation_1st: ${$json.recommendation_1st}\n\n[ì •ê·œì‹ PII íƒì§€ ê²°ê³¼]\n- summary: ${$json.pii_regex_summary || '(ì •ë³´ ì—†ìŒ)'}\n\n[ë§ˆìŠ¤í‚¹ëœ ë¡œê·¸]\n${$json.redactedSnippet || '(ë¡œê·¸ ì—†ìŒ)'}\n\n[ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½]\n${similar}\n\nìœ„ ì •ë³´ë¥¼ ëª¨ë‘ ê³ ë ¤í•˜ì—¬, ìµœì¢… ê°œì¸ì •ë³´ ìœ ì¶œ ìœ„í—˜ë„ì™€ ì´ë²¤íŠ¸ ìœ í˜•, ìë™ í–‰ë™ì„ ê²°ì •í•˜ì„¸ìš”.\në°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.\n\n{\n  \"botRisk\": \"High | Medium | Low | Safe\",\n  \"eventType_2nd\": \"ë‚´ë¶€ì ì •ë³´ìœ ì¶œ | ê³„ì • íƒˆì·¨ | ì•…ì„± ë©”ì¼ | ì„¤ì • ì˜¤ë¥˜ | ê¸°íƒ€\",\n  \"botAction\": \"IGNORE | ALERT_ONLY | INVESTIGATE | LOCK_ACCOUNT | BLOCK_FIREWALL\",\n  \"shortSummary\": \"ì‚¬ëŒì´ í•œ ëˆˆì— ì´í•´í•  ìˆ˜ ìˆëŠ” í•œ ì¤„ ìš”ì•½ (í•œêµ­ì–´)\",\n  \"reason_2nd\": \"ìµœì¢… íŒë‹¨ ê·¼ê±° (í•œêµ­ì–´ í•œë‘ ë¬¸ë‹¨)\",\n  \"recommendation_2nd\": \"ë³´ì•ˆ ë‹´ë‹¹ìê°€ ì·¨í•  êµ¬ì²´ì ì¸ ì¡°ì¹˜ (í•œêµ­ì–´)\"\n}`;\n\nreturn {\n  ...$json,\n  prompt_llm2: prompt\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1200,
        -1040
      ],
      "id": "4fc2d256-755e-4ccd-ba89-2f3f92513cbc",
      "name": "Code â”€ 2ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±"
    },
    {
      "parameters": {
        "jsCode": "// ì…ë ¥: similar_incidents ë°°ì—´ì´ ì´ë¯¸ ë¶™ì–´ ìˆë‹¤ê³  ê°€ì •\nconst list = $json.similar_incidents || [];\n\nif (!Array.isArray(list) || list.length === 0) {\n  return {\n    ...$json,\n    similar_cases_summary: '(ìœ ì‚¬ ì‚¬ë¡€ ì—†ìŒ)'\n  };\n}\n\nconst maxCases = 3;  // LLMì— ë³´ì—¬ì¤„ ìµœëŒ€ ê°œìˆ˜\nconst lines = [];\n\nfor (let i = 0; i < Math.min(maxCases, list.length); i++) {\n  const item = list[i];\n\n  const score =\n    typeof item.score === 'number'\n      ? `${Math.round(item.score * 100)}%`\n      : '';\n\n  const label = score\n    ? `ìœ ì‚¬ ì‚¬ë¡€ ${i + 1} (${score})`\n    : `ìœ ì‚¬ ì‚¬ë¡€ ${i + 1}`;\n\n  const title = item.title || item.shortSummary || '(ì œëª© ì—†ìŒ)';\n\n  lines.push(`[${label}] ${title}`);\n}\n\nreturn {\n  ...$json,\n  similar_cases_summary: lines.join('\\n')\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        -1040
      ],
      "id": "9d4e20fa-b7c6-46ae-add5-4b3775c0b880",
      "name": "Code â”€ ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½ í…ìŠ¤íŠ¸ ìƒì„±"
    },
    {
      "parameters": {
        "jsCode": "// ìµœì¢… ìœ„í—˜ë„ (LLM2 ê¸°ì¤€)\nconst risk = $json.botRisk || 'Safe';\n\n// PII ì¡´ì¬ ì—¬ë¶€\nconst piiByRegex = !!$json.pii_regex_found;\nconst piiByLLM1 = !!$json.pii_found_1st;  // ì—†ìœ¼ë©´ falseë¡œ ì²˜ë¦¬ë¨\n\n// ìœ„í—˜ë„ê°€ ì˜ë¯¸ ìˆëŠ” ìˆ˜ì¤€ì¸ì§€ (High / Medium)\nconst isRisky = (risk === 'High' || risk === 'Medium');\n\n// PIIê°€ ì „í˜€ ì—†ëŠ”ì§€\nconst noPII = !piiByRegex && !piiByLLM1;\n\n// ìµœì¢… í•™ìŠµ ëŒ€ìƒ ì—¬ë¶€\nconst ai_learn_enabled = isRisky && noPII;\n\nreturn {\n  ...$json,\n  ai_learn_enabled\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2208,
        -1024
      ],
      "id": "c95b3c74-666c-4765-9288-791c790fa47b",
      "name": "í•™ìŠµ ëŒ€ìƒ ì—¬ë¶€ ê³„ì‚°"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "536e00fe-9d5e-4bc9-a22e-ff61cfc052e5",
              "leftValue": "={{ $('ìµœì¢… í•„ë“œ ì •ë¦¬').item.json.ai_learn_enabled }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -960,
        -448
      ],
      "id": "c9e3af7c-19e0-4dac-87ef-bab43001e758",
      "name": "IF - í•™ìŠµ ëŒ€ìƒì¸ê°€?"
    },
    {
      "parameters": {
        "jsCode": "const data = $json;\n\n// â¶ ìœ„í—˜ë„/ì´ë²¤íŠ¸/PII ìš”ì•½\nconst risk =\n  data.bot_risk_final ||\n  data.botRisk ||\n  data.property_ai ||          // Notion ê²°ê³¼ìš©\n  'Unknown';\n\nconst eventType =\n  data.eventType_2nd ||\n  data.property_ ||            // Notion ê²°ê³¼ìš©\n  'ê¸°íƒ€';\n\nconst piiSummary =\n  data.pii_regex_summary ||\n  (Array.isArray(data.property_pii)\n    ? `PII ìœ í˜•: ${data.property_pii.join(', ')}`\n    : 'PII íƒì§€ ì—†ìŒ');\n\n// â· ìš”ì•½/ì‚¬ìœ /ì¡°ì¹˜\nconst summary =\n  data.shortSummary_2nd ||\n  data.shortSummary ||\n  data.property_title ||\n  data.name ||\n  '(ìš”ì•½ ì—†ìŒ)';\n\nconst reason =\n  data.reason_2nd ||\n  data.reason_1st ||\n  '(ë¶„ì„ ê·¼ê±° ì—†ìŒ)';\n\nconst recommendation =\n  data.recommendation_2nd ||\n  data.recommendation_1st ||\n  '(ì¡°ì¹˜ ì—†ìŒ)';\n\n// â¸ ë¡œê·¸\nconst log =\n  data.Log_Detail ||\n  data.redactedSnippet ||\n  '(ì›ë³¸ ë¡œê·¸ ë¯¸í¬í•¨)';\n\n// â¹ ìµœì¢… í•™ìŠµ í…ìŠ¤íŠ¸\nconst learnText = `\n[ë³´ì•ˆ ì¸ì‹œë˜íŠ¸ í•™ìŠµìš© ë°ì´í„°]\n- ìœ„í—˜ë„: ${risk}\n- ì´ë²¤íŠ¸ ìœ í˜•: ${eventType}\n- ìš”ì•½: ${summary}\n- ë¶„ì„ ê·¼ê±°: ${reason}\n- ê¶Œì¥ ì¡°ì¹˜: ${recommendation}\n- PII íƒì§€ ìš”ì•½: ${piiSummary}\n\n[ë¡œê·¸ ìŠ¤ë‹ˆí«]\n${log}\n`;\n\nreturn {\n  ...data,\n  learnText,\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -640,
        -544
      ],
      "id": "7818f2c7-ec6b-4bd6-a702-bc0725f51052",
      "name": "Code â”€ í•™ìŠµìš© í…ìŠ¤íŠ¸ ìƒì„±",
      "executeOnce": false
    },
    {
      "parameters": {
        "mode": "insert",
        "memoryKey": {
          "__rl": true,
          "value": "vector_store_key",
          "mode": "list",
          "cachedResultName": "vector_store_key"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        -208,
        -544
      ],
      "id": "bd4926ff-41b6-4bfc-bd0a-f9eeadc6ecfe",
      "name": "Security KB - í•™ìŠµ ë°ì´í„° ì¶”ê°€"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ì´ ë…¸ë“œëŠ” LLM #1ì˜ ì¶œë ¥ í•œ ê±´ì„ ì…ë ¥ìœ¼ë¡œ ë°›ëŠ”ë‹¤.\n// êµ¬ì¡° ì˜ˆì‹œ:\n// {\n//   \"source\": \"DB_AUDIT\",\n//   ...,\n//   \"redactedSnippet\": \"...\",\n//   \"text\": \"{ \\\"risk\\\": \\\"High\\\", \\\"pii_found\\\": true, ... }\"\n// }\n\n// 1) LLMì´ ì¤€ JSON ë¬¸ìì—´ êº¼ë‚´ê¸°\nconst rawText =\n  $json.text ||      // ê¸°ë³¸: text í•„ë“œ\n  $json.llm1_raw ||  // í˜¹ì‹œ ë‹¤ë¥¸ í‚¤ë¥¼ ì¼ë‹¤ë©´\n  $json.response ||  // í˜¸í™˜ìš©\n  $json.content || '';\n\nif (!rawText) {\n  throw new Error(\n    'LLM ì‘ë‹µì—ì„œ text/llm1_raw/response/content í•„ë“œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\\n' +\n    'í˜„ì¬ ì…ë ¥ JSON:\\n' + JSON.stringify($json, null, 2)\n  );\n}\n\n// 2) ì•ë’¤ ê³µë°± + ```json ì½”ë“œë¸”ë¡ ì œê±°\nlet cleaned = String(rawText).trim();\n\ncleaned = cleaned\n  .replace(/^```[a-zA-Z]*\\n?/, '')  // ë§¨ ì•ì˜ ```json\\n ë˜ëŠ” ``` ì œê±°\n  .replace(/```$/, '')              // ë§¨ ë’¤ì˜ ``` ì œê±°\n  .trim();\n\n// 3) JSON íŒŒì‹±\nlet parsed;\ntry {\n  parsed = JSON.parse(cleaned);\n} catch (e) {\n  throw new Error(\n    'LLM #1 JSON íŒŒì‹± ì‹¤íŒ¨: ' + e.message +\n    '\\n--- rawText ---\\n' + rawText +\n    '\\n--- cleaned ---\\n' + cleaned\n  );\n}\n\n// parsed ì˜ˆì‹œ:\n// {\n//   \"risk\": \"High\",\n//   \"pii_found\": true,\n//   \"pii_types\": [\"Email\",\"PhoneNumber\",\"RRN\"],\n//   \"reason\": \"...\",\n//   \"recommendation\": \"...\"\n// }\n\n// 4) ê¸°ì¡´ í•„ë“œëŠ” ê·¸ëŒ€ë¡œ ë‘ê³ , 1ì°¨ ë¶„ì„ ê²°ê³¼ë§Œ ë§ì…í˜\nreturn {\n  ...$json,\n\n  risk_1st: parsed.risk || 'Safe',\n  pii_found_1st: !!parsed.pii_found,\n  pii_types_1st: parsed.pii_types || [],\n  reason_1st: parsed.reason || '',\n  recommendation_1st: parsed.recommendation || ''\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        -1040
      ],
      "id": "f6db8d7c-086b-4b3d-9b58-e483d8994133",
      "name": "1ì°¨ LLM ê²°ê³¼ íŒŒì‹±"
    },
    {
      "parameters": {
        "jsCode": "// Vector Storeê°€ ë¹„ì–´ ìˆì„ ë•Œ í…ŒìŠ¤íŠ¸ìš©\nconst similar_incidents = [\n  {\n    score: 0.95,\n    title: \"[High] DB ë°±ì—… ê³¼ì •ì—ì„œ ì£¼ë¯¼ë²ˆí˜¸ í¬í•¨ ë°ì´í„° ìœ ì¶œ ì‚¬ë¡€\",\n    shortSummary: \"svc_backup ê³„ì •ì´ ì´ë©”ì¼, ì „í™”ë²ˆí˜¸, ì£¼ë¯¼ë²ˆí˜¸ í¬í•¨ ë°ì´í„°ë¥¼ ì™¸ë¶€ ì „ì†¡í•œ ì¼€ì´ìŠ¤\"\n  },\n  {\n    score: 0.82,\n    title: \"[Medium] ë°±ì—… ë¡œê·¸ ë‚´ ì£¼ë¯¼ë²ˆí˜¸ í•„ë“œ ë…¸ì¶œ ì‚¬ë¡€\",\n    shortSummary: \"ë¡œê·¸ íŒŒì¼ ë‚´ ì£¼ë¯¼ë²ˆí˜¸ê°€ ë§ˆìŠ¤í‚¹ë˜ì§€ ì•Šì€ ë¬¸ì œë¡œ íƒì§€ë¨\"\n  },\n  {\n    score: 0.77,\n    title: \"[Low] ë°ì´í„° ë°±ì—… ì¤‘ ê°œì¸ì •ë³´ í•„ë“œ ê²€ì¦ ë¯¸ë¹„\",\n    shortSummary: \"PII ê²€ì¦ ë¡œì§ ëˆ„ë½ìœ¼ë¡œ ë°±ì—… íŒŒì¼ì— ê°œì¸ì •ë³´ í¬í•¨\"\n  }\n];\n\nreturn {\n  ...$json,\n  similar_incidents\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        736,
        -928
      ],
      "id": "35d5967c-841b-424a-8667-26e5dc068f5f",
      "name": "Code â€“ Security KB ê²°ê³¼ ì •ë¦¬"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// 1) LLM #2 ì‘ë‹µ(JSON ë¬¸ìì—´) êº¼ë‚´ê¸°\nconst rawText =\n  $json.text ||      // LLM ë…¸ë“œê°€ text í•„ë“œì— ë„£ì–´ì¤€ ì‘ë‹µ\n  $json.response ||  // ë‹¤ë¥¸ í˜•íƒœ ëŒ€ë¹„\n  $json.content ||   // chat-style ëŒ€ë¹„\n  '';\n\nif (!rawText) {\n  throw new Error(\n    'LLM #2 ì‘ë‹µì—ì„œ text/response/content í•„ë“œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\\n' +\n    'í˜„ì¬ ì…ë ¥ JSON:\\n' + JSON.stringify($json, null, 2)\n  );\n}\n\n// 2) ```json ... ``` ë°©ì–´ + JSON íŒŒì‹±\nlet cleaned = String(rawText).trim()\n  .replace(/^```[a-zA-Z]*\\n?/, '')\n  .replace(/```$/, '')\n  .trim();\n\nlet parsed;\ntry {\n  parsed = JSON.parse(cleaned);\n} catch (e) {\n  throw new Error(\n    'LLM #2 JSON íŒŒì‹± ì‹¤íŒ¨: ' + e.message +\n    '\\n--- rawText ---\\n' + rawText +\n    '\\n--- cleaned ---\\n' + cleaned\n  );\n}\n\n// 3) ê¸°ì¡´ ë°ì´í„°($json) ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ, ê·¸ ìœ„ì— LLM #2 í•„ë“œë§Œ ë§ë¶™ì´ê¸°\nreturn {\n  ...$json,\n\n  botRisk: parsed.botRisk || 'Medium',\n  eventType_2nd: parsed.eventType_2nd || 'ê¸°íƒ€',\n  botAction: parsed.botAction || 'ALERT_ONLY',\n  shortSummary_2nd: parsed.shortSummary || '',\n  reason_2nd: parsed.reason_2nd || '',\n  recommendation_2nd: parsed.recommendation_2nd || '',\n\n  // ë””ë²„ê¹…ìš©ìœ¼ë¡œ ì›ë³¸ textë„ ë‚¨ê²¨ë‘ê³  ì‹¶ìœ¼ë©´:\n  llm2_raw: rawText,\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1744,
        -1040
      ],
      "id": "e4051e5e-6b79-458e-98d9-f48ea95c398b",
      "name": "LLM #2 ê²°ê³¼ íŒŒì‹±"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2000,
        -1120
      ],
      "id": "cd1f7caa-63e8-4d5a-a83d-60b5d2bc7dd0",
      "name": "Merge â”€ LLM2 ê²°ê³¼ + PII ì •ê·œì‹ ê²°ê³¼ í†µí•©"
    },
    {
      "parameters": {
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "text",
                "value": "={{ $json.learnText || '' }}\n"
              },
              {
                "name": "risk",
                "value": "={{ $json.bot_risk_final || $json.botRisk || $json.property_ai || 'Unknown' }}\n"
              },
              {
                "name": "eventType",
                "value": "={{ $json.eventType_2nd || $json.property_ || 'ê¸°íƒ€' }}\n"
              },
              {
                "name": "pii",
                "value": "={{ \n  $json.pii_regex_summary \n  || (\n    Array.isArray($json.property_pii)\n      ? 'PII ìœ í˜•: ' + $json.property_pii.join(', ')\n      : 'PII íƒì§€ ì—†ìŒ'\n  ) \n}}\n"
              },
              {
                "name": "source",
                "value": "={{ $json.source || $json.system || $json.meta?.body?.system || 'SECURITY_PIPELINE' }}\n"
              },
              {
                "name": "title",
                "value": "={{ $json.notion_title || $json.property_title || $json.name || 'ì œëª© ì—†ìŒ' }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -112,
        -384
      ],
      "id": "2aaae4af-9288-4aab-b7d2-51fd765c2391",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "url": "=https://idm.example.com/lock?user={{ $json.meta.user_id }}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -496,
        304
      ],
      "id": "d973d3e1-ddb4-4687-9ab1-b4144af64d9f",
      "name": "HTTP Request",
      "notes": "ê³„ì • ì ê¸ˆ"
    }
  ],
  "pinData": {},
  "connections": {
    "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸": {
      "main": [
        []
      ]
    },
    "ë³´ì•ˆ ì§€ì‹ ë² ì´ìŠ¤ (ê²€ìƒ‰ìš©)": {
      "ai_tool": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI ë‹¨ê¸° ë©”ëª¨ë¦¬": {
      "ai_memory": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "ë³´ì•ˆ ë¡œê·¸ ìˆ˜ì§‘ Webhook": {
      "main": [
        [
          {
            "node": "ë¡œê·¸ ì •ê·œí™” (Code)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë³´ì•ˆ ë¹„ì„œ ì±„íŒ… ì…ë ¥ íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "1ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "1ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸": {
      "main": [
        [
          {
            "node": "1ì°¨ LLM ê²°ê³¼ íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "LLM #2 - ìµœì¢… íŒê²°",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Get many database pages in Notion": {
      "ai_tool": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code Tool": {
      "ai_tool": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ìë™ ëŒ€ì‘ ë¶„ê¸°(Switch)": {
      "main": [
        [],
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upstage Solar Chat for Agent": {
      "ai_languageModel": [
        [
          {
            "node": "ë³´ì•ˆ ë¶„ì„ AI ì—ì´ì „íŠ¸",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Upstage Embed for Agent": {
      "ai_embedding": [
        [
          {
            "node": "ë³´ì•ˆ ì§€ì‹ ë² ì´ìŠ¤ (ê²€ìƒ‰ìš©)",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Upstage Solar Chat for Agent1": {
      "ai_languageModel": [
        [
          {
            "node": "1ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Upstage Embed for Agent2": {
      "ai_embedding": [
        [
          {
            "node": "Security KB ê²€ìƒ‰ (ìœ ì‚¬ ì¸ì‹œë˜íŠ¸)",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Upstage Solar Chat for Agent2": {
      "ai_languageModel": [
        [
          {
            "node": "LLM #2 - ìµœì¢… íŒê²°",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ì›ë³¸ ë¡œê·¸ ë§ˆìŠ¤í‚¹ ë° ì‚­ì œ1": {
      "main": [
        [
          {
            "node": "1ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PII ì •ê·œì‹ ì‚¬ì „ íƒì§€": {
      "main": [
        [
          {
            "node": "ì›ë³¸ ë¡œê·¸ ë§ˆìŠ¤í‚¹ ë° ì‚­ì œ1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge â”€ LLM2 ê²°ê³¼ + PII ì •ê·œì‹ ê²°ê³¼ í†µí•©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a database page": {
      "main": [
        [
          {
            "node": "IF - í•™ìŠµ ëŒ€ìƒì¸ê°€?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upstage Embed for Agent3": {
      "ai_embedding": [
        [
          {
            "node": "Security KB - í•™ìŠµ ë°ì´í„° ì¶”ê°€",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "ë¡œê·¸ ì •ê·œí™” (Code)": {
      "main": [
        [
          {
            "node": "PII ì •ê·œì‹ ì‚¬ì „ íƒì§€",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Security KB ê²€ìƒ‰ (ìœ ì‚¬ ì¸ì‹œë˜íŠ¸)": {
      "main": [
        [
          {
            "node": "Code â€“ Security KB ê²°ê³¼ ì •ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ìµœì¢… í•„ë“œ ì •ë¦¬": {
      "main": [
        [
          {
            "node": "Create a database page",
            "type": "main",
            "index": 0
          },
          {
            "node": "ìë™ ëŒ€ì‘ ë¶„ê¸°(Switch)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM #2 - ìµœì¢… íŒê²°": {
      "main": [
        [
          {
            "node": "LLM #2 ê²°ê³¼ íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code â”€ 2ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±": {
      "main": [
        [
          {
            "node": "LLM #2 - ìµœì¢… íŒê²°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code â”€ ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½ í…ìŠ¤íŠ¸ ìƒì„±": {
      "main": [
        [
          {
            "node": "Code â”€ 2ì°¨ ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "í•™ìŠµ ëŒ€ìƒ ì—¬ë¶€ ê³„ì‚°": {
      "main": [
        [
          {
            "node": "ìµœì¢… í•„ë“œ ì •ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - í•™ìŠµ ëŒ€ìƒì¸ê°€?": {
      "main": [
        [
          {
            "node": "Code â”€ í•™ìŠµìš© í…ìŠ¤íŠ¸ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Code â”€ í•™ìŠµìš© í…ìŠ¤íŠ¸ ìƒì„±": {
      "main": [
        [
          {
            "node": "Security KB - í•™ìŠµ ë°ì´í„° ì¶”ê°€",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1ì°¨ LLM ê²°ê³¼ íŒŒì‹±": {
      "main": [
        [
          {
            "node": "Code â”€ ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½ í…ìŠ¤íŠ¸ ìƒì„±",
            "type": "main",
            "index": 0
          },
          {
            "node": "Security KB ê²€ìƒ‰ (ìœ ì‚¬ ì¸ì‹œë˜íŠ¸)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code â€“ Security KB ê²°ê³¼ ì •ë¦¬": {
      "main": [
        [
          {
            "node": "Code â”€ ìœ ì‚¬ ì‚¬ë¡€ ìš”ì•½ í…ìŠ¤íŠ¸ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM #2 ê²°ê³¼ íŒŒì‹±": {
      "main": [
        [
          {
            "node": "Merge â”€ LLM2 ê²°ê³¼ + PII ì •ê·œì‹ ê²°ê³¼ í†µí•©",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge â”€ LLM2 ê²°ê³¼ + PII ì •ê·œì‹ ê²°ê³¼ í†µí•©": {
      "main": [
        [
          {
            "node": "í•™ìŠµ ëŒ€ìƒ ì—¬ë¶€ ê³„ì‚°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Security KB - í•™ìŠµ ë°ì´í„° ì¶”ê°€",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b5a56c73-2725-45f8-971e-12d1063ea260",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9aaaf3aa8f67d9e72dc175be9e8aea45ea7ff9273685b98d92ef9113b62da103"
  },
  "id": "1hvCzZqU2DjsAPz4",
  "tags": []
}